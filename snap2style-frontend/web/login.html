<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login — Snap2Style</title>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    .page { min-height: 100svh; display:flex; flex-direction:column; }
    .center { flex:1; display:grid; place-items:center; padding:32px 16px; }
    .auth-card {
      width:min(520px, 92vw);
      border-radius:22px;
      border:1px solid var(--stroke);
      background: var(--card);
      backdrop-filter: var(--glass);
      padding:24px;
      box-shadow: 0 18px 60px #0007, inset 0 1px 0 #ffffff14;
    }
    .auth-title { margin:0 0 14px; font-size:28px; }
    .field { display:flex; flex-direction:column; gap:8px; margin:10px 0; }
    .btn-wide { width:100%; }
    .muted { color:var(--muted); font-size:14px; margin-top:10px; }
    .msg { min-height:22px; margin-top:8px; color:#cfd2dc; }
    .banner{
      margin:0 auto 12px; max-width:520px; padding:10px 12px; border-radius:12px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);
      color:#cfd2dc;
      backdrop-filter: var(--glass);
    }
  </style>
</head>
<body>
  <!-- bg -->
  <div class="bg-layer bg-stars"></div>
  <div class="bg-layer bg-gradient"></div>
  <div class="bg-glow"></div>

  <!-- nav -->
  <header class="nav glass">
    <div class="brand">
      <a href="snap.html" class="mark">Snap2Style</a>
    </div>
    <nav>
      <a href="register.html" class="btn-secondary" style="margin-right:12px;">Register</a>
      <button id="acctBtn" class="acct-btn" title="Account"><span id="acctInitial">?</span></button>
    </nav>
  </header>

  <!-- account dropdown -->
  <div id="acctOverlay" class="acct-backdrop" aria-hidden="true">
    <div class="acct-menu" role="menu" aria-label="Account menu">
      <div class="acct-head">
        <div class="acct-avatar" id="acctAvatar">?</div>
        <div class="acct-title">
          <div class="acct-email" id="acctEmail">Guest</div>
          <div class="acct-plan" id="acctPlan">Not signed in</div>
        </div>
      </div>
      <div class="acct-sep"></div>
      <div class="acct-list" id="authedItems" style="display:none">
        <a class="acct-item" href="plans.html">Upgrade plan</a>
        <button class="acct-item acct-danger" id="logoutItem" type="button">Log out</button>
      </div>
      <div class="acct-list" id="guestItems" style="display:none">
        <a class="acct-item" href="login.html">Log in</a>
        <a class="acct-item" href="register.html">Register</a>
      </div>
    </div>
  </div>

  <main class="page">
    <section class="center">
      <div id="justRegBanner" class="banner" style="display:none;">
        Account created! Please log in. We’ve sent a verification link to your email.
      </div>
      <div id="verifiedBanner" class="banner" style="display:none;">
        Email verified ✅ You can log in now.
      </div>

      <form id="loginForm" class="auth-card" autocomplete="on">
        <h2 class="auth-title">Welcome back</h2>

        <div class="field">
          <label>Email</label>
          <input id="email" type="email" inputmode="email" autocomplete="email" required />
        </div>

        <div class="field">
          <label>Password</label>
          <input id="password" type="password" autocomplete="current-password" required />
        </div>

        <button id="loginBtn" class="btn-primary btn-wide" type="submit">Login</button>
        <div class="msg" id="msg"></div>
        <div class="muted">New here? <a href="register.html">Register</a></div>
      </form>
    </section>
  </main>

  <script>
    const API = location.origin.includes(':8000') ? location.origin : 'http://127.0.0.1:8000';
    const form = document.getElementById('loginForm');
    const msg  = document.getElementById('msg');
    const btn  = document.getElementById('loginBtn');

    (function(){
      const q = new URLSearchParams(location.search);
      if (q.get('just_registered')) document.getElementById('justRegBanner').style.display = 'block';
      if (q.get('verified'))       document.getElementById('verifiedBanner').style.display   = 'block';
    })();

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      btn.disabled = true;
      msg.textContent = 'Logging in…';
      try {
        const res = await fetch(API + '/auth/login', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          credentials: 'include',
          body: JSON.stringify({
            email: document.getElementById('email').value.trim(),
            password: document.getElementById('password').value
          })
        });

        const text = await res.text();
        let data; try { data = JSON.parse(text); } catch {}
        if (!res.ok) {
          if (res.status === 401) throw new Error('Invalid email or password.');
          throw new Error((data && (data.error || data.detail)) || ('HTTP ' + res.status));
        }

        msg.textContent = 'Logged in! Redirecting…';
        setTimeout(()=>{ location.href = 'upload.html'; }, 600);
      } catch (err) {
        console.error('[login] error', err);
        msg.textContent = err.message || 'Login failed.';
      } finally {
        btn.disabled = false;
      }
    });

    
  </script>
  <script src="/web/js/app.js?v=2" defer></script>
<script src="/web/js/auth-gate.js?v=1" defer></script>
<form id="loginForm">
  <input id="loginEmail" type="email" autocomplete="email" required />
  <input id="loginPass"  type="password" autocomplete="current-password" required />
  <button type="submit">Log in</button>
  <div id="loginMsg"></div>
</form>

<script src="js/login.js" defer></script>
<script src="/web/js/app.js?v=2"></script>
<script src="/web/js/auth-gate.js?v=1"></script>
<img src="/web/google.svg">


</body>
</html>
